<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
    <h3>
        Status: <h4 style="red" id="status">Not Loaded</h4>
    </h3>
    
    <textarea rows="4" cols="50" id="textInput"></textarea>
    <button id="submitBtn" disabled="true">Loading Model...</button>

    <pre><code id="output"></code></pre>

    <script type="module">
        import {StarCoder as StarCoder} from "../dist/starcoder.js";

        const on_loaded = () => {
            console.log('model: Loaded')
            document.getElementById('status').innerText = 'LOADED'
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitBtn').innerText = "Generate";
        }

        const write_result = (line) => {
            document.getElementById('output').textContent  += line + "\n";
        }

        const run_model = () => {
            const text = document.getElementById("textInput").value;
            document.getElementById('submitBtn').innerText = "Running...";
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('output').textContent = "";
            app.run({
                prompt: text,
                top_k: 1
            });
        }

        const run_complete = () => {
            document.getElementById('submitBtn').innerText = "Generate";
            document.getElementById('submitBtn').disabled = false;
        }
        
        // '../models/tiny_starcoder_py-ggml-q8_0.bin',

        const app = new StarCoder(
            '../models/model.bin',
            on_loaded,
            write_result,
            run_complete
        );
        
        app.load_worker();
        document.getElementById('submitBtn').addEventListener("click", run_model);

    </script>

    </body>
</html>